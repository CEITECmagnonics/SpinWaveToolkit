
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Modeling BLS signal from single magnetic layer &#8212; SpinWaveToolkit v1.2 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=72e0b74d"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_example_nbs/BLS_signal_from_single_layer';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.0';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://ceitecmagnonics.github.io/SpinWaveToolkit/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '1.2';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../_static/logo.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="User Guide" href="../user_guide.html" />
    <link rel="prev" title="Nonreciprocal dispersion of a synthetic antiferromagnet" href="SAFdispersion_simple.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
  <aside class="bd-header-announcement d-print-none d-none" aria-label="Announcement" data-pst-announcement-url="https://raw.githubusercontent.com/CEITECmagnonics/SpinWaveToolkit/master/docs/source/_templates/announcement_banner.html"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt=""/>
    <img src="../_static/logo.svg" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">SpinWaveToolkit</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting_started.html">
    Getting Started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api_reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../release_notes.html">
    Release Notes
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../publications.html">
    Publications
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/CEITECmagnonics/SpinWaveToolkit" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/SpinWaveToolkit/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
          
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting_started.html">
    Getting Started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api_reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../release_notes.html">
    Release Notes
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../publications.html">
    Publications
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/CEITECmagnonics/SpinWaveToolkit" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/SpinWaveToolkit/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="dispersion_relation_basic.html">Basic dispersion relation calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="dispersion_relation_fieldsweeps.html">Dispersion relation calculation - field sweeps</a></li>
<li class="toctree-l1"><a class="reference internal" href="macrospin_equilibrium_histloop.html">Static magnetization equilibrium and hysteresis loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="SAFdispersion_simple.html">Nonreciprocal dispersion of a synthetic antiferromagnet</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Modeling BLS signal from single magnetic layer</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../examples.html" class="nav-link">Examples</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Modeling BLS signal from single magnetic layer</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Modeling-BLS-signal-from-single-magnetic-layer">
<h1>Modeling BLS signal from single magnetic layer<a class="headerlink" href="#Modeling-BLS-signal-from-single-magnetic-layer" title="Link to this heading">#</a></h1>
<p>This example shows how SpinWaveToolkit (SWT) can be used to calculate the expected BLS signal of a single magnetic layer.</p>
<p>We start by impoting the modules we need and by defining the parameters of the system and model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import modules</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">SpinWaveToolkit</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">SWT</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define parameters</span>
<span class="n">Bext</span> <span class="o">=</span> <span class="mf">50e-3</span>         <span class="c1"># External field [T]</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>    <span class="c1"># Out-of-plane angle (fixed)</span>
<span class="n">d_layer</span> <span class="o">=</span> <span class="mf">30e-9</span>      <span class="c1"># Magnetic layer thickness [m]</span>
<span class="n">material</span> <span class="o">=</span> <span class="n">SWT</span><span class="o">.</span><span class="n">NiFe</span>  <span class="c1"># Material (from built-ins)</span>
<span class="n">Nf_common</span> <span class="o">=</span> <span class="mi">101</span>       <span class="c1"># Number of frequency points for Bloch function</span>

<span class="c1"># Define the Kx,Ky grid limits and resolution.</span>
<span class="n">Nk</span> <span class="o">=</span> <span class="mi">100</span>             <span class="c1"># resolution in Kx and Ky</span>
<span class="n">k_max</span> <span class="o">=</span> <span class="mf">15e6</span>         <span class="c1"># maximum k (as in original kxi range)</span>
<span class="n">NA</span> <span class="o">=</span> <span class="mf">0.75</span>            <span class="c1"># Numerical Aperture (NA) for the lens</span>

<span class="c1"># Create a regular Kx,Ky grid</span>
<span class="n">kx_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">k_max</span><span class="p">,</span> <span class="n">k_max</span><span class="p">,</span> <span class="n">Nk</span><span class="p">)</span>
<span class="n">ky_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">k_max</span><span class="p">,</span> <span class="n">k_max</span><span class="p">,</span> <span class="n">Nk</span><span class="p">)</span>
<span class="n">kx_grid</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">kx_grid</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-6</span>  <span class="c1"># avoid division by zero at k=0</span>
<span class="n">kx_grid</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">kx_grid</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="n">KX</span><span class="p">,</span> <span class="n">KY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">kx_grid</span><span class="p">,</span> <span class="n">ky_grid</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">KX</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">KY</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">PHI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">KY</span><span class="p">,</span> <span class="n">KX</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we calculate the electric field incident on the magnetic layer using the <code class="docutils literal notranslate"><span class="pre">ObjectiveLens</span></code> class, get the Bloch functions in 3D and compute the BLS signal using the <code class="docutils literal notranslate"><span class="pre">getBLSsignal</span></code> function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Preparing focal field...&quot;</span><span class="p">)</span>
<span class="n">objective</span> <span class="o">=</span> <span class="n">SWT</span><span class="o">.</span><span class="n">bls</span><span class="o">.</span><span class="n">ObjectiveLens</span><span class="p">(</span><span class="n">NA</span><span class="o">=</span><span class="n">NA</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="mf">532e-9</span><span class="p">,</span> <span class="n">f0</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span> <span class="n">Ez</span> <span class="o">=</span> <span class="n">objective</span><span class="o">.</span><span class="n">getFocalField</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rho_max</span><span class="o">=</span><span class="mf">10e-6</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span> <span class="n">Ez</span><span class="p">]</span>
<span class="n">Exy</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>

<span class="c1"># Preallocate the output array for the Bloch function amplitudes.</span>
<span class="c1"># The result will be complex amplitudes defined on a common frequency axis.</span>
<span class="c1"># Shape: (Nf_common, Nk, Nk)</span>
<span class="n">Bloch2D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nf_common</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">Nk</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="c1"># We will also store the common frequency axis.</span>
<span class="n">w_common</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="n">Nf_common</span><span class="p">)</span><span class="o">*</span><span class="mf">2e9</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># (rad/s)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Preparing Bloch functions in 3D (f,kx,ky) using Kalinikos-Slavin model...&quot;</span><span class="p">)</span>
<span class="c1"># Create a SingleLayer model for the current kxi and phi.</span>
<span class="c1"># Note: We pass kxi and phi as arbitrary values for now.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SWT</span><span class="o">.</span><span class="n">SingleLayer</span><span class="p">(</span><span class="n">Bext</span><span class="o">=</span><span class="n">Bext</span><span class="p">,</span> <span class="n">kxi</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span>
                        <span class="n">phi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">d_layer</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">)</span>
<span class="c1"># Loop over all grid points in the Kx,Ky plane.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nk</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nk</span><span class="p">):</span>
        <span class="c1"># Set correct kxi and phi for the current grid point.</span>
        <span class="n">model</span><span class="o">.</span><span class="n">kxi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],))</span>  <span class="c1"># must be an array</span>
        <span class="n">model</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">PHI</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="c1"># Compute the Bloch functions for n=0,1; higher n are outside `w_common`</span>
        <span class="c1"># The returned w has shape (Nf_common,) and bf has shape (Nf_common, 1),</span>
        <span class="c1"># since we are passing kxi as length-1 array.</span>
        <span class="c1"># We pass also parameters for Bose-Einstein distribution (optional).</span>
        <span class="n">w0</span><span class="p">,</span> <span class="n">bf0</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">GetBlochFunction</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nf</span><span class="o">=</span><span class="n">Nf_common</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">mu</span><span class="o">=-</span><span class="mf">1e12</span><span class="o">*</span><span class="n">SWT</span><span class="o">.</span><span class="n">H</span><span class="p">)</span>
        <span class="n">w1</span><span class="p">,</span> <span class="n">bf1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">GetBlochFunction</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nf</span><span class="o">=</span><span class="n">Nf_common</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">mu</span><span class="o">=-</span><span class="mf">1e12</span><span class="o">*</span><span class="n">SWT</span><span class="o">.</span><span class="n">H</span><span class="p">)</span>
        <span class="c1"># Interpolate the Bloch functions to the common frequency axis.</span>
        <span class="n">bf0_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">w_common</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">bf0</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">bf1_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">w_common</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">bf1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Sum Bloch functions for n=0,1</span>
        <span class="n">Bloch2D</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">bf0_interp</span> <span class="o">+</span> <span class="n">bf1_interp</span>

<span class="n">Bloch3</span> <span class="o">=</span> <span class="p">[</span><span class="n">Bloch2D</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nf_common</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">Nk</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">),</span> <span class="n">Bloch2D</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing BLS signal from Kalinikos-Slavin model...&quot;</span><span class="p">)</span>
<span class="c1"># Compute the BLS signal using the Bloch functions and the electric field.</span>
<span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span> <span class="o">=</span> <span class="n">SWT</span><span class="o">.</span><span class="n">bls</span><span class="o">.</span><span class="n">getBLSsignal</span><span class="p">(</span>
    <span class="c1"># The Bloch functions and related axis vectors</span>
    <span class="n">SweepBloch</span><span class="o">=</span><span class="n">w_common</span><span class="p">,</span> <span class="n">KxKyBloch</span><span class="o">=</span><span class="p">[</span><span class="n">kx_grid</span><span class="p">,</span> <span class="n">ky_grid</span><span class="p">],</span> <span class="n">Bloch</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Bloch3</span><span class="p">),</span>
    <span class="n">Exy</span><span class="o">=</span><span class="n">Exy</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="n">E</span><span class="p">,</span>  <span class="c1"># the incoming electric field from the objective</span>
    <span class="n">Nq</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># number of points to use in the k-space integration</span>
    <span class="c1"># dielectric functions of the multilayer system: air, NiFe, substrate</span>
    <span class="n">DF</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.1653</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mf">15.348</span><span class="p">,</span> <span class="mf">17.237</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mf">0.43004</span><span class="p">],</span>
    <span class="n">PM</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># same for permeabilities (response of NiFe is included in the Bloch functions)</span>
    <span class="n">d</span><span class="o">=</span><span class="p">[</span><span class="n">d_layer</span><span class="p">],</span> <span class="c1"># thicknesses of the inner layers, here just NiFe</span>
    <span class="n">NA</span><span class="o">=</span><span class="n">NA</span><span class="p">,</span> <span class="c1"># numerical aperture of the collecting objective (here the same as focusing)</span>
    <span class="n">source_layer_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># layer with the magnetic film</span>
    <span class="n">output_layer_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># layer in which we observe the scattered light (air)</span>
    <span class="c1"># other parameters of the optical setup</span>
    <span class="n">wavelength</span><span class="o">=</span><span class="mf">532e-9</span><span class="p">,</span> <span class="n">collectionSpot</span><span class="o">=</span><span class="mf">0.5e-6</span><span class="p">,</span> <span class="n">focalLength</span><span class="o">=</span><span class="mf">1e-3</span>
<span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Preparing focal field...
Preparing Bloch functions in 3D (f,kx,ky) using Kalinikos-Slavin model...
Computing BLS signal from Kalinikos-Slavin model...
Done
</pre></div></div>
</div>
<p>Finally, we plot the resulting BLS signal.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the BLS signal</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_common</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ey</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Ey</span><span class="p">)),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Kalinikos-Slavin model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;frequency (GHz)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;BLS intensity (a.u.)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;BLS signal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/_example_nbs_BLS_signal_from_single_layer_6_0.png" src="../_images/_example_nbs_BLS_signal_from_single_layer_6_0.png" />
</div>
</div>
<p><em>(Note: Sometimes the relative amplitude of PSSW peaks does not match the experiment, since it may depend on a vast number of parameters. If that is the case, calculate the BLS signal separately and normalize to each respective peak.)</em></p>
<section id="Tip-on-speeding-things-up">
<h2>Tip on speeding things up<a class="headerlink" href="#Tip-on-speeding-things-up" title="Link to this heading">#</a></h2>
<p>Calculations of 2D dispersion and Bloch functions using some dispersion models can be greatly accelerated when we pass the <code class="docutils literal notranslate"><span class="pre">K</span></code> and <code class="docutils literal notranslate"><span class="pre">PHI</span></code> as flattened arrays. What happens is that if the model does not iterate over wavenumbers, it can calculate the dispersion for the whole 1d array of wavenumbers at once (therefore there is no need for the double for loop). If we supply a parameter of the same shape, it may be broadcasted together. The only thing we need to do then is to reshape the acquired
data back to our square reciprocal space grid.</p>
<p>Unfortunately, this is currently supported only by the <code class="docutils literal notranslate"><span class="pre">SingleLayer</span></code> class at the moment. Maybe we will try to implement it in a limited form also in other classes.</p>
<p>For example this code from above</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="c1"># Create a SingleLayer model for the current kxi and phi.</span>
<span class="c1"># Note: We pass kxi and phi as arbitrary values for now.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SWT</span><span class="o">.</span><span class="n">SingleLayer</span><span class="p">(</span><span class="n">Bext</span><span class="o">=</span><span class="n">Bext</span><span class="p">,</span> <span class="n">kxi</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span>
                        <span class="n">phi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">d_layer</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">)</span>
<span class="c1"># Loop over all grid points in the Kx,Ky plane.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nk</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nk</span><span class="p">):</span>
        <span class="c1"># Set correct kxi and phi for the current grid point.</span>
        <span class="n">model</span><span class="o">.</span><span class="n">kxi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],))</span>  <span class="c1"># must be an array</span>
        <span class="n">model</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">PHI</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="c1"># Compute the Bloch functions for n=0,1; higher n are outside `w_common`</span>
        <span class="c1"># The returned w has shape (Nf_common,) and bf has shape (Nf_common, 1),</span>
        <span class="c1"># since we are passing kxi as length-1 array.</span>
        <span class="c1"># We pass also parameters for Bose-Einstein distribution (optional).</span>
        <span class="n">w0</span><span class="p">,</span> <span class="n">bf0</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">GetBlochFunction</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nf</span><span class="o">=</span><span class="n">Nf_common</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">mu</span><span class="o">=-</span><span class="mf">1e12</span><span class="o">*</span><span class="n">SWT</span><span class="o">.</span><span class="n">H</span><span class="p">)</span>
        <span class="n">w1</span><span class="p">,</span> <span class="n">bf1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">GetBlochFunction</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nf</span><span class="o">=</span><span class="n">Nf_common</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">mu</span><span class="o">=-</span><span class="mf">1e12</span><span class="o">*</span><span class="n">SWT</span><span class="o">.</span><span class="n">H</span><span class="p">)</span>
        <span class="c1"># Interpolate the Bloch functions to the common frequency axis.</span>
        <span class="n">bf0_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">w_common</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">bf0</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">bf1_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">w_common</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">bf1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Sum Bloch functions for n=0,1</span>
        <span class="n">Bloch2D</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">bf0_interp</span> <span class="o">+</span> <span class="n">bf1_interp</span>

<span class="n">Bloch3</span> <span class="o">=</span> <span class="p">[</span><span class="n">Bloch2D</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nf_common</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">Nk</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">),</span> <span class="n">Bloch2D</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">]</span>
<span class="c1"># ...</span>
</pre></div>
</div>
</div>
<p>can be replaced by this</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="c1"># Create a SingleLayer model for the current kxi and phi.</span>
<span class="c1"># Note: We pass kxi and phi as flattened arrays of same shape.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SWT</span><span class="o">.</span><span class="n">SingleLayer</span><span class="p">(</span><span class="n">Bext</span><span class="o">=</span><span class="n">Bext</span><span class="p">,</span> <span class="n">kxi</span><span class="o">=</span><span class="n">K</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span>
                        <span class="n">phi</span><span class="o">=</span><span class="n">PHI</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">d</span><span class="o">=</span><span class="n">d_layer</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">)</span>
<span class="c1"># Compute the Bloch functions for n=0,1.</span>
<span class="c1"># The returned w has shape (Nf_common,) and bf has shape (Nf_common, len(kxi))</span>
<span class="n">w0</span><span class="p">,</span> <span class="n">bf0</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">GetBlochFunction</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nf</span><span class="o">=</span><span class="n">Nf_common</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">mu</span><span class="o">=-</span><span class="mf">1e12</span><span class="o">*</span><span class="n">SWT</span><span class="o">.</span><span class="n">H</span><span class="p">)</span>
<span class="n">w1</span><span class="p">,</span> <span class="n">bf1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">GetBlochFunction</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nf</span><span class="o">=</span><span class="n">Nf_common</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">mu</span><span class="o">=-</span><span class="mf">1e12</span><span class="o">*</span><span class="n">SWT</span><span class="o">.</span><span class="n">H</span><span class="p">)</span>
<span class="c1"># reshape Bloch functions to match the Kx,Ky grid shape</span>
<span class="n">bf0</span> <span class="o">=</span> <span class="n">bf0</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">Nf_common</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">Nk</span><span class="p">))</span>
<span class="n">bf1</span> <span class="o">=</span> <span class="n">bf1</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">Nf_common</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">Nk</span><span class="p">))</span>
<span class="c1"># Loop over all grid points in the Kx,Ky plane.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nk</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nk</span><span class="p">):</span>
        <span class="c1"># Interpolate the Bloch functions to the common frequency axis.</span>
        <span class="n">bf0_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">w_common</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">bf0</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">bf1_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">w_common</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">bf1</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Sum Bloch functions for n=0,1,2</span>
        <span class="n">Bloch2D</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">bf0_interp</span> <span class="o">+</span> <span class="n">bf1_interp</span>

<span class="n">Bloch3</span> <span class="o">=</span> <span class="p">[</span><span class="n">Bloch2D</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nf_common</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">Nk</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">),</span> <span class="n">Bloch2D</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">]</span>
<span class="c1"># ...</span>
</pre></div>
</div>
</div>
<p>which is much faster in most cases. More specifically, here it is about 100 faster, but is depends greatly on number of points in the grid (more convenient with large number of points).</p>
<p><em>(Note that the double for loop was not totally eliminated, since we need to perform the interpolation of the Bloch functions at each point.)</em></p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="SAFdispersion_simple.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Nonreciprocal dispersion of a synthetic antiferromagnet</p>
      </div>
    </a>
    <a class="right-next"
       href="../user_guide.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">User Guide</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Tip-on-speeding-things-up">Tip on speeding things up</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/_example_nbs/BLS_signal_from_single_layer.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright 2025-2026, CEITECmagnonics and SpinWaveToolkit contributors.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__center">
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>